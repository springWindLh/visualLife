<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="/static/css/base.css">
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/font-awesome.min.css">
    <style type="text/css">
        blockquote {
            padding: 10px 20px;
            margin: 0 0 20px;
            font-size: 17.5px;
            border-left: 5px solid #94785e;
        }
    </style>
</head>
<body>
<div th:include="fragment::navbar"></div>
<div class="container padding-top50 bg-white">
    <div class="text-center">
        <h4 th:text="${form.title}"></h4>
    </div>
    <div class="text-center">
        <small class="text-muted">作者：<span th:text="${form.user.name}"></span>
            &nbsp;&nbsp;&nbsp;
            <span th:text="${#dates.format(form.createdTime,'yyyy/MM/dd')}"></span>
        </small>
    </div>
    <hr>
    <div>
        <p th:utext="${form.content}"></p>
    </div>
</div>
<div class="container" ng-app="commentApp">
    <div ng-controller="commentController">
        <div ng-repeat="comment in comments track by $index">
            <div class="col-md-3">
                <img ng-src="comment.user.avatar" class="width40 height40 borderRadius50">
            </div>
            <div class="col-lg-9">
                <div class="height20">
                    <label class="width50">{{comment.user.name}}</label><small class="text-muted">{{comment.createdTime | date:'yyyy/MM/dd HH:mm'}}</small>
                </div>
                <div>
                    <p>{{comment.content}}</p>
                </div>
            </div>
        </div>
        <div>
            <form>
            <div>
                <textarea rows="3" class="form-control" ng-maxlength="500" ng-model="$scope.newComment.content"></textarea>
            </div>
            <div>
                <button type="button" class="btn btn-info" ng-click="saveComment()">发表</button>
            </div>
            </form>
        </div>
    </div>
</div>
<div th:include="fragment::tooltip"></div>
</body>
<script type="text/javascript" th:inline="javascript">
    var commentApp = angular.module('commentApp',[]);
    commentApp.controller('commentController',function ($scope,$http) {
        $scope.comments = [];
        var targetId = [[${form.id}]];
        var targetType = 'ARTICLE';
        $http.get('/comment/list',{params:{
            page:0,
            size:500,
            targetType:targetType,
            targetId:targetId
        }}).success(function (data) {
            if(data.code) {
                $scope.comments = data.contents;
            }else{
                Tooltip.fail(data.msg);
            }
        });

        $scope.saveComment = function () {
            $scope.newComment = {
                targetType: targetType,
                targetId: targetId,
                content: ''
            };
              $http.post('/comment/add',$scope.newComment).success(function (data) {
                  if(data.code) {

                  }else {
                      Tooltip.fail(data.msg);
                  }
              });
        };
    });
</script>
</html>